<!-- document.getElementById("replaceMe").innerHTML = "Access code: " + code; -->

<html>
  <head>
    <script>
      function doLogin() {
        let clientId = document.getElementById("consumer_key").value;
        let clientSecret = document.getElementById("consumer_secret").value;
        
        let params = (new URL(document.location)).searchParams;
        let code = params.get("code");
        
        if (clientId !== '' && code === null) { 
          let url = 'https://visioncare--devkpren.my.salesforce.com/services/oauth2/authorize?client_id=';
          url += clientId;
          url += '&redirect_uri=https%3A%2F%2Fkprenger.github.io%2FLightningOutTest&response_type=code';
        
          window.location.replace(url);
        } else if (clientId !== '' && clientSecret !== '' && code !== null) {
          getAuthToken(code, clientId, clientSecret);
        }
      };
      
      function getAuthToken(code, clientId, clientSecret) {
        let bodyString = 'grant_type=authorization_code&code=';
        bodyString += code;
        bodyString += '&client_id=';
        bodyString += clientId;
        bodyString += '&client_secret=';
        bodyString += clientSecret;
        bodyString += '&redirect_uri=https://kprenger.github.io/LightningOutTest';
        
        fetch('https://visioncare--devkpren.my.salesforce.com/services/oauth2/token', {
          method: 'POST',
          body: bodyString,
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        }).then(function (resp) {
          return resp.json();
        }).then(function (data) {
          console.log('token', data);
        }).catch(function (err) {
          console.log('something went wrong', err);
        });
      }
    </script>
  </head>
  <body>
    <h1>Lightning Out Test</h1>

    <input type="text" id="consumer_key" name="consumer_key"><br><br>
    <input type="text" id="consumer_secret" name="consumer_secret"><br><br>

    <input id="clickMe" type="button" value="Log in" onclick="doLogin();" />

    <div id="replaceMe">
      This will be replaced.
    </div>
  </body>
</html>
